# 📊 Управление товарами через Excel

Эта система позволяет автоматически парсить товары из интернет-магазинов и обновлять каталог бота.

## 🚀 Быстрый старт

### 1. Создай шаблон Excel

```bash
python update_products.py
```

Будет создан файл `products_links.xlsx` с такой структурой:

| URL | Название | Цена (₽) | Описание | Эмодзи | Последнее обновление | Статус |
|-----|----------|-----------|----------|---------|---------------------|--------|
| ссылка на товар | автоматически | автоматически | автоматически | 🏐 | 2025-01-15 14:30 | ✅ Обновлено |

### 2. Заполни ссылки

Открой `products_links.xlsx` и:
1. Вставь URL товаров в колонку **A** (URL)
2. Заполни эмодзи в колонке **E** (опционально)
3. Остальные колонки заполнятся автоматически

**Поддерживаемые сайты:**
- ✅ tradeinn.com
- ✅ Любые сайты с JSON-LD разметкой (большинство современных магазинов)
- ✅ Сайты с Open Graph мета-тегами

### 3. Запусти парсинг

```bash
python update_products.py
```

Скрипт:
- Прочитает все URL из Excel
- Спарсит товары (название, цену, описание)
- Обновит Excel файл актуальными данными
- Покажет результат

**Пример вывода:**
```
═══════════════════════════════════════════════════════════
🕷️  ПАРСИНГ ТОВАРОВ
═══════════════════════════════════════════════════════════

[1] Парсинг: https://www.tradeinn.com/volleyball/ru/asics-...
    ✅ Asics Gel-Tactic 2
       Цена: 8499 ₽

[2] Парсинг: https://example.com/product/...
    ✅ Кроссовки Nike
       Цена: 12500 ₽

═══════════════════════════════════════════════════════════
✅ Обновлено товаров: 2
❌ Ошибок: 0
📄 Файл сохранён: products_links.xlsx
═══════════════════════════════════════════════════════════
```

### 4. Запусти бота

```bash
python mini_app.py
```

Бот автоматически загрузит товары из Excel файла!

## 📋 Как это работает

### Структура файлов

```
minin app/
│
├── mini_app.py              # Главный файл бота
├── update_products.py       # Скрипт парсинга
├── products_links.xlsx      # Excel с товарами (создаётся автоматически)
└── requirements.txt
```

### Workflow

1. **Ручное заполнение:**
   - Открываешь `products_links.xlsx`
   - Вставляешь ссылки на товары

2. **Автоматический парсинг:**
   - Запускаешь `python update_products.py`
   - Скрипт извлекает данные с сайтов
   - Обновляет Excel файл

3. **Загрузка в бот:**
   - Запускаешь `python mini_app.py`
   - Бот читает товары из Excel
   - Если Excel нет — использует стандартные товары

## 🛠 Как парсится товар?

### 1. JSON-LD (Schema.org)

Большинство современных магазинов используют JSON-LD разметку:

```html
<script type="application/ld+json">
{
  "@type": "Product",
  "name": "Asics Gel-Tactic 2",
  "description": "...",
  "offers": {
    "price": "8499",
    "priceCurrency": "RUB"
  }
}
</script>
```

Скрипт извлекает эти данные.

### 2. Open Graph мета-теги

Если JSON-LD нет, парсятся мета-теги:

```html
<meta property="og:title" content="Название товара">
<meta property="og:description" content="Описание">
<meta property="product:price:amount" content="1500">
```

## 📝 Примеры

### Пример 1: tradeinn.com

```
URL: https://www.tradeinn.com/volleyball/ru/asics-gel-tactic-2-asics/139269743/p
Эмодзи: 🏐
```

Результат:
```
Название: Asics Gel-Tactic 2
Цена: 8499 ₽
Описание: Волейбольные кроссовки с технологией Gel
```

### Пример 2: Другой магазин

```
URL: https://example-shop.com/products/sneakers-nike
Эмодзи: 👟
```

Скрипт попытается извлечь данные через JSON-LD или мета-теги.

## ⚙️ Настройка парсинга

### Добавить новый сайт

Открой `update_products.py` и добавь функцию:

```python
def parse_yoursite_product(url):
    """Парсит товар с yoursite.com."""
    try:
        response = requests.get(url, timeout=10)
        html = response.text

        # Твоя логика парсинга
        name = ...
        price = ...
        description = ...

        return {
            "name": name,
            "description": description,
            "price": price
        }, None

    except Exception as e:
        return None, f"Ошибка: {str(e)}"
```

Затем добавь в функцию `parse_product()`:

```python
def parse_product(url):
    if "yoursite.com" in url:
        return parse_yoursite_product(url)
    # ...
```

## 🔄 Обновление цен

Чтобы обновить цены на уже спаршенных товарах:

1. Открой Excel (ссылки уже там)
2. Запусти: `python update_products.py`
3. Скрипт обновит все товары
4. Перезапусти бота: `python mini_app.py`

## ⚠️ Важно

### Частота парсинга

Не парси слишком часто! Рекомендации:
- Раз в день — безопасно
- Раз в час — может вызвать подозрения
- Постоянно — бан

### Легальность

- Парсинг публичных данных = OK
- Соблюдай `robots.txt` сайта
- Не перегружай сервера (используй задержки)

### Бан сайта

Если сайт заблокировал:
- Используй официальные API (если есть)
- Увеличь задержки между запросами
- Используй proxies (опционально)

## 🆘 Troubleshooting

### Ошибка: "JSON-LD не найден"

Сайт не использует JSON-LD разметку. Варианты:
1. Попробуй другой URL товара
2. Добавь кастомный парсер для этого сайта
3. Заполни данные вручную в Excel

### Ошибка: "Цена не найдена"

Сайт скрывает цену или использует JavaScript:
1. Заполни цену вручную в Excel
2. Напиши кастомный парсер

### Excel файл пустой

Проверь:
1. Есть ли URL в колонке A?
2. Запущен ли `update_products.py`?
3. Есть ли ошибки в колонке "Статус"?

### Бот использует стандартные товары

Проверь:
1. Существует ли `products_links.xlsx`?
2. Есть ли заполненные строки (Название + Цена)?
3. Перезапусти бота

## 💡 Советы

1. **Используй эмодзи** — каталог выглядит привлекательнее
2. **Обновляй редко** — раз в день достаточно
3. **Проверяй данные** — цены могут быть с НДС/без НДС
4. **Бэкап Excel** — сохраняй копию перед обновлением

## 🔗 Полезное

- [Schema.org Product](https://schema.org/Product) — стандарт JSON-LD
- [Open Graph Protocol](https://ogp.me/) — мета-теги
- [robots.txt](https://www.robotstxt.org/) — правила парсинга

---

**Готово!** Теперь ты можешь управлять каталогом через Excel 🎉
